## Redis 挂了怎么办？ #元象24 #面过

[✅Redis 如果挂了，你怎么办？ (yuque.com)](https://www.yuque.com/hollis666/krcpbs/ni9yghphzz5utfhp)

## 如何做平滑的数据迁移? #面过 




## 如何解决接口幂等的问题？  #面过

https://www.yuque.com/hollis666/krcpbs/gz2qwl#QEycl

1. 一锁：先加锁。分布式锁或者悲观锁都可以，但一定要是==互斥锁！==
2. 二判：进行幂等性判断。可以基于状态机、流水表、唯一性索引等等进行重复操作的判断。
3. 三更新：进行数据的更新，将数据进行持久化。

第一步加锁、和第二步判断的时候，通常需要和上游约定一个唯一 ID 作为幂等号。然后通过==对幂等号加锁，再通过幂等号进行幂等判断==即可。

> 第一步加锁为了解决高并发场景下的幂等问题，如果没有高并发， 不需要第一步了，就直接查询，更新，在更新的时候做乐观锁控制就行


## 为什么不建议用数据库唯一性约束做幂等控制？

https://www.yuque.com/hollis666/krcpbs/prnect4g81wg2law